{% extends 'utsida/layout.html' %}

{% block content %}
    {% load result_extras %}

    <div id="savedCoursesContainer" class="panel panel-primary square-corners boxShadow savedCoursesContainer">
        <div class="panel-heading pointer noSelect square-corners" onclick="toggleSavedCoursesContainer()">
            Dine NTNU fag
            <span class="badge">{{ user.profile.coursesToTake.all.count }}</span>
            <span id="savedCoursesContainerChevron" class="glyphicon glyphicon-chevron-down pull-right"></span>
        </div>
        <div class="panel-body" id="savedCoursesContainerBody">
            <ul>
                {% for course in user.profile.coursesToTake.all %}
                    <li>{{ course }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <div id="selectedCourseContainer" class="panel panel-primary square-corners boxShadow selectedCourseContainer">
        <div id="handle" class="panel-heading square-corners pointer" onclick="courseSelector.toggleSelectedCourses()">
            Dine valgte fag
            <span class="badge" id="numSelectedCoursesBadge"></span>
            <span id="selectedCourseToggleBtn" class="pull-right glyphicon glyphicon-chevron-up"></span>
        </div>
        <div id="selectedCourseBody" class="panel-body">
            <ul id="selectedCourseList"></ul>
        </div>
        <div id="selectedCourseFooter" class="panel-footer">
            <button onclick="courseSelector.removeAllSelectedCourses()" class="btn btn-default"><span class="glyphicon glyphicon-trash"></span> Tøm listen</button>
            <button onclick="courseSelector.saveCourses()" class="btn btn-default pull-right">
                <span class="glyphicon glyphicon-ok"></span>
                Lagre fag
            </button>
        </div>
    </div>

    <div id="filters" class="row vertical-space-bottom-big">
        <h2 class="text-center">Her er turene som likner mest på ditt søk</h2>
        <h3 class="subTitle text-center vertical-space-bottom">
            Trykk på fagene andre studenter har hatt for å velge de.
        </h3>

        <div class="col-md-6 col-md-offset-3 vertical-space-top">
            <select class="form-control" onchange="UniversityFilter.filter()" id="universitySelector">
                <option value="all">Alle</option>
                {% for university in universities %}
                    <option value="{{ university }}">{{ university }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Uncomment to switch to label filtering
        <div class="col-md-8 col-md-offset-2 vertical-space-top">
            <a href="/process/result/all"><button class="btn btn-default vertical-space-bottom-small">All</button></a>
            {% for university in universities %}
                <a href="/process/result/{{ university }}"><button class="btn btn-default vertical-space-bottom-small">{{ university }}</button></a>
            {% endfor %}
        </div>
        -->

    </div>

    <div id="results" class="row vertical-space-top-big">

        {% for case in similar_cases %}
            {% if forloop.counter|divisibleby:3 %}<div class="row">{% endif %}
            <div class="col-md-4">
                <div class="panel panel-primary square-corners boxShadow">
                    <div class="panel-heading square-corners">
                        <span class="resultPanelUniversity">{{ case.University }} ({{ case.Country }})</span> <span class="pull-right badge similarityBadge">{{ case.Similarity|parse_similarity:100 }}</span>
                    </div>
                    <div class="panel-body">
                        <div class="subjectsContainer">
                            {% for subject in case.Subjects %}
                                {% if subject in matches.keys %}
                                    <div onclick="courseSelector.addCourse(this)"
                                         class="btn btn-success courseBtn"
                                         data-container="body"
                                         data-toggle="popover"
                                         data-placement="top"
                                         data-content="Dette faget er en godkjent erstatning for ditt følgende valgt fag på NTNU: {{ matches | get:subject }}"
                                         data-trigger="hover">
                                    {{ subject }}
                                    </div>
                                {% else %}
                                    <div onclick="courseSelector.addCourse(this)" class="btn btn-warning courseBtn">{{ subject }}</div>
                                {% endif %}
                            {% endfor %}
                        </div>

                        <hr>

                        <div class="hiddenInformation">
                            <div>
                                <p><span class="bold">Institutt hjemme:</span> {{ case.Institute }}</p>
                                <p><span class="bold">Verdensdel:</span> {{ case.Continent }}</p>
                                <p><span class="bold">Land:</span> {{ case.Country }}</p>
                                <p><span class="bold">Universitet:</span> {{ case.University }}</p>
                                <p>
                                    <span class="bold">Studiespråk:</span>
                                    {% for language in case.Language %}
                                        {{ language }}
                                    {% endfor %}
                                </p>
                                <p><span class="bold">Studieperiode:</span> {{ case.StudyPeriod }}</p>
                                <p><span class="bold">Vurdering av akademisk kvalitet:</span> {{ case.AcademicQuality }}</p>
                                <p><span class="bold">Vurdering av sosial kvalitet:</span> {{ case.SocialQuality}}</p>
                                <p><span class="bold">Vurdering av kvalitet og anskaffelse av bolig:</span> {{ case.ResidentialQuality }}</p>
                                <p><span class="bold">Vurdering av administrativ støtte:</span> {{ case.ReceptionQuality}}</p>
                            </div>
                        </div>
                        <div class="text-center">
                            <span id="expandTripChevron" style="color: #337ab7; cursor: pointer;" class="accordion glyphicon glyphicon-chevron-down"></span>
                        </div>
                    </div>
                </div>
            </div>
            {% if forloop.counter|divisibleby:3 %}</div>{% endif %}
        {% endfor %}

        <button class="btn btn-success boxShadow square-corners checkoutBtn" onclick="courseSelector.checkout()">Gå til lagrede fag <span class="glyphicon glyphicon-chevron-right"></span></button>
    </div>

    <script>

    </script>

    {% load staticfiles %}
    <script src="{% static 'utsida/javascripts/result/showHiddenContent.js' %}"></script>
    <script src="{% static 'utsida/javascripts/result/courseSelector.js' %}"></script>
    <script src="{% static 'utsida/javascripts/result/universityFilter.js' %}"></script>




{% endblock %}
